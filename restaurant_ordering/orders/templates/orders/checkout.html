{% extends "base.html" %}

{% block title %}结账页面{% endblock %}

{% block content %}
<h2>结账</h2>

<div id="order-summary"></div>

<h3 id="total-price">总金额: ￥0.00</h3>

<button class="floating-button" onclick="goToPayment()">💳 立即支付</button>

<script>
    let orderData = JSON.parse(localStorage.getItem('orderData')) || {};
    let menuItems = {{ menu_items|safe }};

    function renderOrderSummary() {
        let totalPrice = 0;
        let orderSummaryHTML = "<ul>";

        for (let itemId in orderData) {
            if (orderData[itemId] > 0) {
                let item = menuItems.find(i => i.id == itemId);
                let itemTotal = item.price * orderData[itemId];

                orderSummaryHTML += `<li>${item.name} x ${orderData[itemId]} = ￥${itemTotal.toFixed(2)}</li>`;
                totalPrice += itemTotal;
            }
        }

        orderSummaryHTML += "</ul>";
        document.getElementById("order-summary").innerHTML = orderSummaryHTML;
        document.getElementById("total-price").innerText = `总金额: ￥${totalPrice.toFixed(2)}`;
    }

    function goToPayment() {
        let encodedOrderData = encodeURIComponent(JSON.stringify(orderData));
        window.location.href = `{% url 'create_checkout_session' %}?orderData=${encodedOrderData}`;
    }

    renderOrderSummary();
</script>
{% endblock %}



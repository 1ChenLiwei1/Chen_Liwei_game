<!DOCTYPE html>
<html lang="zh">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <title>结账</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <h1>结账</h1>

   <table>
    <tr>
        <th>菜品</th>
        <th>单价</th>
        <th>数量</th>
        <th>总价</th>
    </tr>
    {% for item in order_items %}
    <tr>
        <td>{{ item.menuitem.name }}</td>
        <td>${{ item.menuitem.price }}</td>
        <td>{{ item.quantity }}</td>
        <td>${{ item.menuitem.price|floatformat:2 }}</td>
    </tr>
    {% endfor %}
</table>
<p>总金额: ${{ total_price }}</p>

    <button class="floating-button" onclick="goToPayment()">💳 立即支付</button>
</body>
</html>



<script>
    let orderData = JSON.parse(localStorage.getItem('orderData')) || {};
    let menuItems = {{ menu_items|safe }};

    function renderOrderSummary() {
        let totalPrice = 0;
        let orderSummaryHTML = "<ul>";

        for (let itemId in orderData) {
            if (orderData[itemId] > 0) {
                let item = menuItems.find(i => i.id == itemId);
                let itemTotal = item.price * orderData[itemId];

                orderSummaryHTML += `<li>${item.name} x ${orderData[itemId]} = ￥${itemTotal.toFixed(2)}</li>`;
                totalPrice += itemTotal;
            }
        }

        orderSummaryHTML += "</ul>";
        document.getElementById("order-summary").innerHTML = orderSummaryHTML;
        document.getElementById("total-price").innerText = `总金额: ￥${totalPrice.toFixed(2)}`;
    }

    function goToPayment() {
        let encodedOrderData = encodeURIComponent(JSON.stringify(orderData));
        window.location.href = `{% url 'create_checkout_session' %}?orderData=${encodedOrderData}`;
    }

    renderOrderSummary();

</script>



